#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# SECURITY: Scan for secrets before committing
echo "üîí Scanning for secrets with gitleaks..."
if command -v gitleaks >/dev/null 2>&1; then
  gitleaks protect --staged --verbose
  if [ $? -ne 0 ]; then
    echo "‚ùå SECURITY VIOLATION: Secrets detected in staged files!"
    echo "   Please remove all secrets and use environment variables instead."
    echo "   See .env.example for required environment variables."
    exit 1
  fi
  echo "‚úÖ No secrets detected"
else
  echo "‚ö†Ô∏è  gitleaks not installed - skipping secret scan"
  echo "   Install with: brew install gitleaks (macOS) or apt-get install gitleaks (Linux)"
fi

# Run lint-staged for staged files
npx lint-staged

# Run XPRESS compliance check (non-blocking - warnings only)
echo "üé® Checking XPRESS Design System compliance..."
npm run xpress:check || echo "‚ö†Ô∏è  XPRESS compliance warnings detected (non-blocking)"

echo "‚úÖ Pre-commit checks completed!"